# ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุธุงู ููููู ุงููุญุงุณุจู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุจูุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู **Supabase (PostgreSQL)** ูุน ุชุทุจูู Row Level Security (RLS) ุนูู ุฌููุน ุงูุฌุฏุงูู ูุถูุงู ุฃูุงู ุงูุจูุงูุงุช.

---

## ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

### 1. ุฌุฏุงูู ุงููุธุงู ุงูุฃุณุงุณู

#### `branches` - ุงููุฑูุน
- ุฅุฏุงุฑุฉ ุงููุฑูุน ุงููุฎุชููุฉ ููุดุฑูุฉ
- ูุญุชูู ุนูู ุงูุจูุงูุงุช ุงูุถุฑูุจูุฉ ูุงูุณุฌู ุงูุชุฌุงุฑู
- **ุงูุฃุนูุฏุฉ ุงูุฑุฆูุณูุฉ:**
  - `name_ar`, `name_en` - ุฃุณูุงุก ุงููุฑุน
  - `vat_number` - ุงูุฑูู ุงูุถุฑูุจู
  - `cr_number` - ุฑูู ุงูุณุฌู ุงูุชุฌุงุฑู
  - `address`, `phone` - ูุนูููุงุช ุงูุงุชุตุงู

#### `users_profile` - ูููุงุช ุงููุณุชุฎุฏููู
- ูููุงุช ุงููุณุชุฎุฏููู ูุน ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
- **ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ:**
  - `admin` - ูุฏูุฑ ุงููุธุงู
  - `manager` - ูุฏูุฑ ูุฑุน
  - `cashier` - ูุงุดูุฑ
  - `accountant` - ูุญุงุณุจ
  - `inventory_manager` - ูุฏูุฑ ูุฎุฒูู

### 2. ุฌุฏุงูู ุงูููุชุฌุงุช ูุงููุฎุฒูู

#### `products` - ุงูููุชุฌุงุช
- ูุชุงููุฌ ุงูููุชุฌุงุช ุงููุงูู
- ูุฏุนู SKU ู Barcode
- ูุญุชูู ุนูู ุงูุฃุณุนุงุฑ ูุงูุชูุงููู ููุณุจุฉ ุงูุถุฑูุจุฉ

#### `inventory` - ุงููุฎุฒูู
- ูููุงุช ุงูููุชุฌุงุช ูู ูู ูุฑุน
- ูุฏุนู ููุทุฉ ุฅุนุงุฏุฉ ุงูุทูุจ (ROP)
- **ูููุฒุงุช:**
  - ุชุชุจุน ุงููููุฉ ุงููุชููุฑุฉ
  - ุงููููุฉ ุงููุญุฌูุฒุฉ
  - ุชูุจููุงุช ุงููุฎุฒูู ุงูููุฎูุถ

#### `stock_movements` - ุญุฑูุงุช ุงููุฎุฒูู
- ุชุณุฌูู ุฌููุน ุญุฑูุงุช ุงููุฎุฒูู
- **ุฃููุงุน ุงูุญุฑูุงุช:**
  - `purchase` - ุดุฑุงุก
  - `sale` - ุจูุน
  - `return` - ูุฑุชุฌุน
  - `adjustment` - ุชุณููุฉ
  - `transfer` - ููู ุจูู ูุฑูุน

### 3. ุฌุฏุงูู ุงููุจูุนุงุช

#### `invoices` - ุงูููุงุชูุฑ
- ุงูููุงุชูุฑ ุงูุฑุฆูุณูุฉ ูุน ูุงูู ุงูุชูุงุตูู
- **ุฃููุงุน ุงูููุงุชูุฑ:**
  - `sale` - ุจูุน
  - `return` - ูุฑุชุฌุน
  - `credit_note` - ุฅุดุนุงุฑ ุฏุงุฆู
- **ุญุงูุงุช ุงูุฏูุน:**
  - `paid` - ูุฏููุนุฉ
  - `pending` - ูุนููุฉ
  - `partial` - ุฏูุน ุฌุฒุฆู
  - `cancelled` - ููุบุงุฉ
- ูุญุชูู ุนูู ุฑูุฒ ZATCA QR

#### `invoice_items` - ุนูุงุตุฑ ุงูููุงุชูุฑ
- ุชูุงุตูู ูู ููุชุฌ ูู ุงููุงุชูุฑุฉ
- ุญุณุงุจ ุชููุงุฆู ููุถุฑูุจุฉ ูุงูุฅุฌูุงููุงุช

#### `payments` - ุงููุฏููุนุงุช
- ุชุณุฌูู ุฌููุน ุงููุฏููุนุงุช
- ูุฏุนู ุทุฑู ุฏูุน ูุชุนุฏุฏุฉ

### 4. ุฌุฏุงูู ุงููุดุชุฑูุงุช

#### `purchase_orders` - ุทูุจุงุช ุงูุดุฑุงุก
- ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุดุฑุงุก ูู ุงูููุฑุฏูู
- ุชุชุจุน ุงููููุงุช ุงููุทููุจุฉ ูุงููุณุชููุฉ

#### `purchase_order_items` - ุนูุงุตุฑ ุทูุจุงุช ุงูุดุฑุงุก
- ุชูุงุตูู ูู ููุชุฌ ูู ุทูุจ ุงูุดุฑุงุก

### 5. ุฌุฏุงูู ุงูุนููุงุก ูุงูููุฑุฏูู

#### `customers` - ุงูุนููุงุก
- ุฅุฏุงุฑุฉ ุงูุนููุงุก
- ูุธุงู ููุงุท ุงูููุงุก
- ุชุชุจุน ุฅุฌูุงูู ุงููุดุชุฑูุงุช

#### `suppliers` - ุงูููุฑุฏูู
- ุฅุฏุงุฑุฉ ุงูููุฑุฏูู
- ูุนูููุงุช ุงูุงุชุตุงู ูุงูุจูุงูุงุช ุงูุถุฑูุจูุฉ

### 6. ุฌุฏุงูู ุงูุฅุฏุงุฑุฉ

#### `cash_shifts` - ุงููุฑุฏูุงุช
- ุฅุฏุงุฑุฉ ูุฑุฏูุงุช ุงููุงุดูุฑ
- ุชุชุจุน ุงูููุฏ ุงูุงูุชุชุงุญู ูุงูุฎุชุงูู
- ุญุณุงุจ ุงููุฑููุงุช

#### `audit_log` - ุณุฌู ุงูุชุฏููู
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงููููุฉ
- ูุญูุธ ุงูุจูุงูุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ ููู ุชุบููุฑ

#### `stock_adjustments` - ุชุณููุงุช ุงููุฎุฒูู
- ุฅุฏุงุฑุฉ ุชุณููุงุช ุงููุฎุฒูู (ุฌุฑุฏุ ุชููุ ุฅูุฎ)
- ุชุชุทูุจ ููุงููุฉ ูู ูุฏูุฑ

#### `promotions` - ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ
- ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ูุงูุฎุตููุงุช
- ูุฏุนู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุนุฑูุถ

---

## ุงููุธุงุฆู (Functions)

### `generate_invoice_number()`
- ุชูููุฏ ุฑูู ูุงุชูุฑุฉ ุชููุงุฆู ุจุตูุบุฉ: `INV-2025-00001`

### `generate_po_number()`
- ุชูููุฏ ุฑูู ุทูุจ ุดุฑุงุก ุจุตูุบุฉ: `PO-2025-00001`

### `update_invoice_totals()`
- ุญุณุงุจ ุชููุงุฆู ูุฅุฌูุงููุงุช ุงููุงุชูุฑุฉ ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุนูุงุตุฑ

### `update_inventory_on_receipt()`
- ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆููุง ุนูุฏ ุงุณุชูุงู ุจุถุงุนุฉ

### `update_inventory_on_sale()`
- ุฎุตู ุงููููุงุช ูู ุงููุฎุฒูู ุชููุงุฆููุง ุนูุฏ ุงูุจูุน

### `apply_stock_adjustment()`
- ุชุทุจูู ุชุณููุงุช ุงููุฎุฒูู ุนูุฏ ุงูููุงููุฉ ุนูููุง

### `log_audit_trail()`
- ุชุณุฌูู ุชููุงุฆู ูู ุณุฌู ุงูุชุฏููู ูุฌููุน ุงูุนูููุงุช ุงููููุฉ

---

## ุณูุงุณุงุช ุงูุฃูุงู (RLS Policies)

### ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ:
1. โ ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู RLS
2. โ ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ููุท ูููููู ุงููุตูู ููุจูุงูุงุช
3. โ ุงูุตูุงุญูุงุช ูุญุฏุฏุฉ ุญุณุจ ุงูุฏูุฑ
4. โ ุณุฌู ุงูุชุฏููู ูููุฑุงุกุฉ ููุท ููุฅุฏุงุฑููู ูุงููุญุงุณุจูู

### ุฃูุซูุฉ ุนูู ุงูุณูุงุณุงุช:

**ุงูููุชุฌุงุช:**
- ุงูุฌููุน: ูุฑุงุกุฉ ุงูููุชุฌุงุช ุงููุดุทุฉ
- ุงููุฏุฑุงุก/ูุฏูุฑ ุงููุฎุฒูู: ุฅุถุงูุฉ ูุชุนุฏูู

**ุงูููุงุชูุฑ:**
- ุงูุฌููุน: ุนุฑุถ ุงูููุงุชูุฑ
- ุงูููุธููู: ุฅูุดุงุก ููุงุชูุฑ
- ุงููุงุดูุฑ: ุชุนุฏูู ููุงุชูุฑู ููุท
- ุงูุฅุฏุงุฑููู: ุญุฐู ุงูููุงุชูุฑ

**ุงููุฎุฒูู:**
- ุงูุฌููุน: ุนุฑุถ ุงููุฎุฒูู
- ุงููุฏุฑุงุก/ูุฏูุฑ ุงููุฎุฒูู: ุชุนุฏูู ุงููููุงุช

---

## ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ (Seed Data)

ุชู ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ:

- โ 2 ูุฑุน (ุงูุฑูุงุถุ ุฌุฏุฉ)
- โ 15 ููุชุฌ ูู ูุฆุงุช ูุฎุชููุฉ
- โ 3 ููุฑุฏูู
- โ 5 ุนููุงุก
- โ ูุฎุฒูู ุฃููู ูุฌููุน ุงูููุชุฌุงุช

---

## ุงูุงุณุชุฎุฏุงู

### 1. ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

```javascript
import { supabase } from './lib/supabase';
```

### 2. ุฌูุจ ุงูููุชุฌุงุช

```javascript
const { data, error } = await supabase
  .from('products')
  .select('*')
  .eq('is_active', true);
```

### 3. ุฅูุดุงุก ูุงุชูุฑุฉ

```javascript
// ุงุณุชุฎุฏู ุงูุฎุฏูุงุช ุงูุฌุงูุฒุฉ
import { createInvoice } from './services/invoicesService';

const invoice = await createInvoice({
  branch_id: 'xxx',
  user_id: 'yyy',
  customer_id: 'zzz',
  items: [...],
  payment_method: 'cash'
});
```

### 4. ุฅุฏุงุฑุฉ ุงููุฎุฒูู

```javascript
import { addToStock, getProductStock } from './services/inventoryService';

// ุฅุถุงูุฉ ูููุฉ
await addToStock(productId, branchId, 100);

// ุงูุชุญูู ูู ุงููุฎุฒูู
const stock = await getProductStock(productId, branchId);
```

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ุงูุฃูุงู:**
- ูุง ุชูู ุฃุจุฏูุง ุจุชุนุทูู RLS
- ุงุณุชุฎุฏู `auth.uid()` ููุชุญูู ูู ุงููุณุชุฎุฏู
- ุฑุงุฌุน ุงูุตูุงุญูุงุช ูุจู ุฃู ุนูููุฉ ุญุณุงุณุฉ

โ๏ธ **ุงูุฃุฏุงุก:**
- ุงุณุชุฎุฏู Indexes ุงููููุดุฃุฉ
- ุงุญุฐุฑ ูู ุฌูุจ ุจูุงูุงุช ูุซูุฑุฉ ุฏูุนุฉ ูุงุญุฏุฉ
- ุงุณุชุฎุฏู `limit()` ุนูุฏ ุงูุญุงุฌุฉ

โ๏ธ **ุงูุชุฏููู:**
- ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ ูุณุฌูุฉ ูู `audit_log`
- ุฑุงุฌุน ุงูุณุฌูุงุช ุจุงูุชุธุงู

---

## ุงูุชุฑููุงุช ุงููุณุชูุจููุฉ

- [ ] ุฅุถุงูุฉ ุฌุฏุงูู ุงูููุงุฒูุงุช
- [ ] ุชูุงุฑูุฑ ูุงููุฉ ูุชูุฏูุฉ
- [ ] ุชูุงูู ูุจุงุดุฑ ูุน ZATCA
- [ ] ูุธุงู ุงูุฅุดุนุงุฑุงุช
- [ ] ุชุญูููุงุช ูุชูุฏูุฉ (BI)
- [ ] Multi-tenant support
